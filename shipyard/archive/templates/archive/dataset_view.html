<!-- Django template -->
<!-- Display contents of Methods as a HTML table -->

{% extends "portal/base.html" %}

{% load filters %}

{% block title %}Datasets{% endblock %}

{% block javascript %}
    <style>
        .col_warn {
            background-color: rgba(255, 203, 0, 0.59);
        }
        .col_error {
            background-color: rgba(255, 29, 0, 0.4);
        }
        th sub {
            font-weight: 100;
            font-size: 0.6em;
        }
        .data-error {
            background-color: rgb(255, 191, 191);
            cursor: pointer;
            position: relative;
        }
        .value-error-tip{
            display: block;
            position: absolute;
            background: rgb(255, 253, 253);
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 1);
            border-radius: 5px;
            width: 300px;
            top: 0;
            right: -320px;
            padding: 10px;
            display: none;
            z-index: 100;
        }
        .value-error-tip ul{
            margin: 0;
            padding: 4px 0 0 25px;
        }
        .value-error-tip li{
            text-size: 0.7em;
        }
    </style>
    <script type="text/javascript" src="/static/portal/jquery-2.0.3.min.js"></script>
<script>
$(document).ready(function(){
    $('.data-error').hover( function(){
        $(this).find('.value-error-tip').show();
    },
    function(){
        $(this).find('.value-error-tip').hide();
    });
});

</script>
{% endblock %}

{% block content %}

<a href="/datasets" rel="prev">Back to list of datasets</a>

<h2>{{ dataset.name }}</h2>
<a href="{{ dataset.get_absolute_url }}">Download</a>

<table>
<thead>
    <tr>
    {% if dataset.content_matches_header %}
       {% for column in dataset.header %}
            <th>{{ column }}</th>
        {% endfor %}
    {% else %}
            <th> Expected: </th>
           {% for column in column_matching %}
                <th>
                    {{ column.0 }}
                </th>
            {% endfor %}
    {% endif %}
    </tr>

    {% if not dataset.content_matches_header %}
    <tr>
        <th> Observed: </th>
        {% for column in column_matching %}
            <th class="{% if column.0 != column.1 and column.0|length == 0  %}col_error{%  elif column.0 != column.1 and column.1|length > 0 %}col_warn{% endif%}">
                {{ column.1 }}
            </th>
        {% endfor %}
    </tr>
    {% endif %}
</thead>
</tbody>
    {% if dataset.content_matches_header %}
        {% for row in processed_rows %}
            <tr>
            {% for value,errors in row %}
                <td {% if errors|length > 0 %} class="data-error" {% endif %}>
                    {{ value|truncatechars:10 }}
                    {% if errors|length > 0 %}
                        <div class="value-error-tip">
                            The following data checks failed:
                            <ul>
                            {% for error in errors %}
                                <li>{{ error }} </li>
                            {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                </td>
            {% endfor %}
            </tr>
        {% endfor %}
    {% else %}
        {% for row in processed_rows %}
            <tr>
                <td></td>
            {% for value,errors in row %}
                <td {% if errors|length > 0 %} class="data-error" {% endif %}>
                    {{ value|truncatechars:10 }}
                    {% if errors|length > 0 %}
                        <div class="value-error-tip">
                             The following data checks failed:
                            <ul>
                            {% for error in errors %}
                                <li>{{ error }} </li>
                            {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                </td>
            {% endfor %}
            </tr>
        {% endfor %}
    {% endif %}
</tbody>
</table>
{% endblock %}
