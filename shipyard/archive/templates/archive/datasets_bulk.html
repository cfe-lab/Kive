<!-- Django template -->
<!-- View recently added bulk datasets -->

{% extends "portal/base.html" %}

{% block title %}Bulk Added Dataset{% endblock %}

<style>
{#    TODO:  put this in CSS#}
    .bulk_dataset_table {
        overflow:scroll;
        height:50em;
        clear: both;
    }

    .status_cell {

    }

    .loading_img {
        width:20px;
        height:20px;
    }

    .display_only_input {
        outline: none;
    }

    textarea:focus, input:focus{
        outline: none;
    }
</style>

{% block javascript %}
    <script src="/static/portal/jquery-2.0.3.min.js"></script>
    <script>
    $(document).ready(function() {
        // TODO:  put these somewhere more central.
        // TODO:  the loading_img css class doesn't work here.  Fix it instead of hardcoding width and height
        STATUS_FAIL = "1"
        STATUS_SUCCESS = "0"

        $('.status_cell').each(function () {
            if ($(this).html() == STATUS_SUCCESS) {
                $(this).html('<img class="loading_img" src="/static/portal/img/success.png" width="20px" height="auto">');
            }
            else {
                $(this).html('<img class="loading_img" src="/static/portal/img/fail.png" width="20px" height="auto">');
            }
        });
    });
    </script>
{% endblock %}



{% block content %}

<a href="usr.html" rel="prev">Back to user's portal</a>

<h2>Bulk Added Datasets</h2>

<form id="bulkDatasetDisplayForm" name="bulkDatasetDisplayForm" action="/datasets_bulk.html" method="post">{% csrf_token %}
    <div class="bulk_dataset_table">
        <table id="uploadProgressTable">
            <thead>
                <tr>
                    <th>File Name</th>
                    <th>File Size</th>
                    <th>Dataset Name</th>
                    <th>Description</th>
                    <th>MD5</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {{ bulk_dataset_formset.management_form }}
                {% for dataset_form in bulk_dataset_formset %}
                    <tr>
                        <!--
                        The dataset filename can change on the server to avoid duplicate names on the fileserver.
                        Display the original filenames as uploaded by the user so that they don't have to map client filenames
                        to server filenames.
                        Use AJAX to post edits to server.
                        Use django formset names so that server can automagically update model.
                       -->
                        <td style="display:none">{{ dataset_form.id }}
                            <div class="errortext">{{ dataset_form.id.errors }}</div>
                        </td>
                        <td>{{ dataset_form.orig_filename }}
                            <div class="errortext">{{ dataset_form.orig_filename.errors }}</div>
                        </td>
                        <td>{{ dataset_form.filesize }}
                            <div class="errortext">{{ dataset_form.filesize.errors }}</div>
                        </td>
                        <td>{{ dataset_form.name }}
                            <div class="errortext">{{ dataset_form.name.errors }}</div>
                        </td>
                        <td>{{ dataset_form.description }}
                            <div class="errortext">{{ dataset_form.description.errors }}</div>
                        </td>
                        <td class="display_only_input">{{ dataset_form.md5 }}
                            <div class="errortext">{{ dataset_form.md5.errors }}</div>
                        </td>
                        <!-- TODO:  use ajax to poll status of each file upload.
                        Will be handy if lots of large files -->
                        <td class="status_cell">{{ dataset_form.status }}</td>
                        <td class="errortext">{{ dataset_form.non_field_errors }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <input type="submit" id="editBulkDatasets" name="editBulkDatasets" value="Submit" />
</form>

{% endblock %}

