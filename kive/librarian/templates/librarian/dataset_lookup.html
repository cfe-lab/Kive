<!-- Django template -->
<!-- Display contents of Methods as a HTML table -->

{% extends "portal/base.html" %}

{% load filters %}

{% block title %}Pipeline Lookup{% endblock %}

{% block javascript %}
    <script type="text/javascript" src="/static/portal/jquery-2.0.3.min.js"></script>
{% endblock %}

{% block content %}
    <a href="/lookup" rel="prev">Back to data lookup</a>
    <h2>Matching runs</h2>


    {% if datasets.count == 0 and datasets_as_inputs.count == 0 %}
        <h3>No matching runs!</h3>
    {% else %}
        <table>
            <thead>
                <th>Run ID</th>
                <th>Output dataset name</th>
                <th>Family</th>
                <th>Pipeline name</th>
                <th>Pipeline revision</th>
                <th></th>
            </thead>
        {% for d in datasets %}
            <tr>
                <td>{{ d.file_source.parent_run.id }}</td>
                <td> <a href="/dataset_view/{{d.id}}"> {{ d.name }} </a> </td>
                <td>{{ d.file_source.parent_run.pipeline.family }} </td>
                <td>
                    {% if  d.file_source.parent_run.pipeline.revision_name|length <= 0 %}
                        {{ d.file_source.parent_run.pipeline.family }}
                    {% else %}
                        {{ d.file_source.parent_run.pipeline.revision_name }}
                    {% endif %}
                </td>
                <td>
                    {{ d.file_source.parent_run.pipeline.revision_number }}
                </td>
                <td>
                    {% ifile_sourced_by == None %}
                        This was an upload
                    {% else %}
                        <a href="/view_run/file_sourceed_by.parent_run.id }}/{{md5}}">View run</a>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}

        {% for d in datasets_as_inputs %}
            <tr>
                <td>{{ d.run.id }}</td>
                <td> <a href="/dataset_view/{{d.dataset.id}}"> {{ d.dataset.name }} </a> </td>
                <td>{{ d.pipeline.family }} </td>
                <td>
                    {% if  d.run.pipeline.revision_name|length <= 0 %}
                        {{ d.run.pipeline.family }}
                    {% else %}
                        {{ d.run.pipeline.revision_name }}
                    {% endif %}
                </td>
                <td>
                    {{ d.pipeline.revision_number }}
                </td>
                <td>
                    <a href="/view_run/{{ d.run.id }}/{{md5}}">View run</a>
                </td>
            </tr>
        {% endfor %}
        </table>
    {% endif %}
{% endblock %}
