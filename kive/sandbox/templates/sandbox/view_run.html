<!-- Django template -->
<!-- Displays a Run-->

{% extends "portal/base.html" %}

{% block title %}Runs{% endblock %}

{% block javascript %}
    <script src="/static/portal/jquery-2.0.3.min.js"></script>
    <script src="/static/portal/noxss.js"></script>
    <script src="/static/portal/system.js"></script>
    <script src="/static/portal/system.config.js"></script>
    <script>
        System.import('/static/sandbox');
    </script>
{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="/static/pipeline/drydock.css"/>
    <style>
        #canvas {  }
        #run_status img {
            vertical-align: middle;
        }
        .pipeline_rdonly_ctrl {
            position: absolute;
            right: 1em;
            top: 80px;
            width: 20%;
            min-width: 150px;
            border: 1px solid #aaa;
            padding: 1em;
            background-color: #fff;
        }
        .pipeline_rdonly_ctrl ul {
            padding: 0;
        }
        .pipeline_rdonly_ctrl li {
            display: block;
        }
        .pipeline_rdonly_ctrl h4 {
            margin-top: 0;
            font-size: 1.3em;
        }
    </style>
{% endblock %}

{% block content %}
    {% if md5 != None %}
        <a href="/datasets_lookup/{{md5}}" rel="prev">Back to matching list</a>
    {% else %}
        <a href="/runs" rel="prev"> Back to runs </a>
    {% endif %}

    <div class="pipeline_rdonly_ctrl ctrl_menu">
        <h4>
            {% if run.description != "" %}
            <span title="{{ run.description }}">
            {% endif %}
            {{ run.display_name }}
            {% if run.description != "" %}
            </span>
            {% endif %}
        </h4>
        <ul>
            {% if run.pipeline.revision_name|length <= 0 %}
                <li> <h5>Pipeline family</h5> {{ run.pipeline.family }} </li>
            {% else %}
                <li> <h5>Pipeline</h5> {{ run.pipeline.revision_name }} ({{ run.pipeline.family }})</li>
            {% endif %}
            <li class="new_ctrl"><h5>Revision #</h5> {{ run.pipeline.revision_number }}</li>

            {% if run.pipeline.revision_desc|length <= 0 %}
                {% if run.pipeline.family.description|length > 0 %}
                    <li class="new_ctrl">{{ run.pipeline.family.description }}</li>
                {% endif %}
            {% else %}
                    <li class="new_ctrl">{{ run.pipeline.revision_desc }}</li>
            {% endif %}
            <li> <h5>Run status</h5> <span id="run_status">Checking...</span> </li>
        </ul>
    </div>

    <div>
        <canvas id="pipeline_canvas" data-editable="false">HTML5 Canvas not supported by this browser.</canvas>
        <div id="method_context_menu" class="context_menu">
            <ul>
                <li data-action="display" class="dataset_node">View Dataset</li>
                <li data-action="download" class="dataset_node">Download Dataset</li>
                <li data-action="viewlog" class="step_node">View Log</li>
                <li data-action="viewerrorlog" class="step_node">View Error Log</li>
            </ul>
        </div>

    </div>

    <input type="hidden" id="run_id" value="{{run.id}}">
    <input type="hidden" id="run_pipeline_id" value="{{run.pipeline.id}}">
    <input type="hidden" id="run_md5" value="{{ md5 }}">

    <!-- These are here because drydock expects them, todo, remove these and refactor the code so as not to need them -->
    <select id="id_pipeline_select" style="display:none"></select>
    <input type="submit" id="id_method_button" value="Add Method" style="display:none">
    <div id="dialog_form">
        <form id="id_output_name_form">
            <label for="output_name">Output name</label>
            <input type="text" name="output_name" id="output_name" class="text">
            <input type="submit" id="output_submit" value="OK">
            <div id="output_name_error"><img src="/static/pipeline/warning_icon.png"> That name has already been used.</div>
        </form>
    </div>
{% endblock %}
